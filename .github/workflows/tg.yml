name: ESET Key Generator

on:
  workflow_dispatch:
    inputs:
      mail:
        description: 'Mail provider'
        required: true
        type: choice
        options:
          - 1secmail
          - guerrillamail
          - developermail
          - mailticking
          - fakemail
          - inboxes
          - incognitomail
          - emailfake
        default: emailfake
      user_chat_id:
        description: 'Telegram chat ID'
        required: true
      os:
        description: 'OS'
        required: true
        type: string
        default: windows-latest

jobs:
  generate:
    runs-on: ${{ inputs.os }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Clone ESET-KeyGen
        run: git clone -b main https://github.com/XHub157/ESET-KeyGen

      - name: Generate keys
        shell: pwsh
        run: |
         cd ESET-KeyGen
         python -m venv venv
         .\venv\Scripts\Activate.ps1
         .\venv\Scripts\pip install -r requirements.txt
         .\venv\Scripts\python main.py --auto-detect-browser --key `
         --email-api "${{ inputs.mail }}" `
         --skip-update-check --no-logo `
         --disable-progress-bar --disable-logging

      - name: Send key to Telegram
        shell: pwsh
        run: |
         cd ESET-KeyGen
         # –ü–æ–ª—É—á–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–ª—é—á –∏–∑ —Ñ–∞–π–ª–∞
         $KEY = Get-Content -Path .\ESET_KEYS.txt -Tail 1
         
         # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
         $MESSAGE = "üîë –í–∞—à –∫–ª—é—á ESET:\n\n$KEY"
         
         # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
         curl.exe -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" `
         -d "chat_id=${{ inputs.user_chat_id }}" `
         -d "text=$MESSAGE" `
         -d "parse_mode=Markdown"
